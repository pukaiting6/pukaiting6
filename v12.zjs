{"repeatCount":-1,"pauseOnFail":true,"count":20,"minVerCode":2015000,"minVerName":"2.15.0","screenWidth":0,"screenHeight":0,"screenDpi":0,"lastSaveScreenWidth":1312,"lastSaveScreenHeight":2848,"lastSaveScreenDpi":3.5,"savedVerCode":2027020,"savedVerName":"2.27.2","description":"","delay":""}
{"type":"运行JS代码","delay":"0","delayUnit":1,"desc":"检查更新","scriptCallbacks":{"beforeStartExec":{"type":"运行JS代码","delay":"0","delayUnit":1,"desc":"查找更新信息","jsCode":"zdjl.toast(\"连接至服务器……\",1000);\nsleep(2000);\nzdjl.toast(\"查找更新文件信息……\");\nsleep(1500)\nfetch('https:\/\/bilibiliales.github.io\/example\/temp\/version\/data.json')\n  .then(response => {\n    if (!response.ok) {\n      throw new Error('当前网络响应错误或请求地址错误');\n    }\n    return response.json();\n  })\n  .then(body => {\n    if (body && typeof body === 'object') {\n      console.log(body); \/\/ 输出整个 JSON 对象\n      var v = body.v;\n      global.v=v;\n      var size = body.size;\n      global.size=size;\n      var checksum1=body.checksum1;\n      global.checksum1=checksum1;\n      var checksum2=body.checksum2;\n      global.checksum2=checksum2;\n      var note = body.note;\n      global.note=note;\n      \/\/输出body\n      console.log('版本:', v);\n      console.log('大小:', size);\n      console.log('校验和1：', checksum1);\n      console.log('校验和2：', checksum2);\n      console.log('说明:', note);\n    } else {\n      console.error('解析JSON数据错误');\n    }\n  })\n  .catch(error => {\n    console.error('错误:', error);\n  });"},"afterExecSuc":{"type":"运行多个动作","delay":"0","delayUnit":1,"scriptSet":[{"type":"系统提示","delay":"0","delayUnit":1,"condition":{"type":"jsExpression","expression":"update==true","desc":""},"promptType":"alert","promptTitle":"发现新版本","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"继续"},{"name":"退出","script":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}}],"__vars":{"promptText":{"varType":"expression","varScope":"script","mustInput":true,"valueExp":"\"当前版本号：12\\n新版本号：\"+v+\"\\n文件大小：\"+size+\"\\n版本描述：\"+note+\"\\n\"+wlan"}}},{"type":"控制执行","delay":"0","delayUnit":1,"condition":{"type":"jsExpression","expression":"stop==true","desc":""},"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}],"runMode":"normal"}},"jsCode":"sleep(2000);\nzdjl.toast(\"检查更新…………\",1000)\nvar stop=true;\nglobal.stop=stop;\nvar update=null;\nglobal.update=update;\nvar wlan=\" \";\nglobal.wlan=wlan;\nvar v0=12;\nglobal.v0=v0;\nvar info=zdjl.getDeviceInfo();\nvar net=info.networkActivated;\nvar wifi=info.networkIsWifi;\nif(net==false){\n  zdjl.toast(\"激活向导\\n未连接网络，请连接网络以后重试\")\n  var stop=true;\nglobal.stop=stop;\n}else{\n   if(wifi==false){\n     sleep(1000)\n  zdjl.toast(\"当前为蜂窝网络环境，继续运行将消耗部分流量\",1000)\n  var wlan=\"当前为蜂窝网络环境，联网更新将消耗部分流量\";\nglobal.wlan=wlan;\n}\n\nvar stop=null;\nglobal.stop=stop;\n}\nsleep(2000);\nconsole.log(v0)\nconsole.log(v)\nif(v>v0){\n  console.log(\"需要更新\");\n  var update=true;\nglobal.update=update;\n}else{\nzdjl.toast(\"无需更新\",1000);\nsleep(2000);}"}
{"type":"运行JS代码","delay":"0","delayUnit":1,"condition":{"type":"jsExpression","expression":"update==true","desc":""},"desc":"更新\/修复脚本的代码","scriptCallbacks":{"afterExecSuc":{"type":"运行多个动作","delay":"0","delayUnit":1,"scriptSet":[{"type":"系统提示","delay":"0","delayUnit":1,"condition":{"type":"jsExpression","expression":"stop==true","desc":""},"promptType":"alert","promptText":"无法验证正确的签名\n可能的原因有：\n1、旧版本的验签服务器已被关闭\n2、下载的文件不完整或文件损坏\n3、未开启文件读写权限或无法达到指定文件目录","promptTitle":"安装失败","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"下一步"}]},{"type":"系统提示","delay":"0","delayUnit":1,"promptType":"alert","promptText":"更新向导运行结束，更新结果已保存至\/sdcard\/documents\/联网更新日志.txt\n\n点击确定后重新启动软件","promptTitle":"更新向导","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"完成","script":{"type":"打开应用","delay":"0","delayUnit":1,"scriptCallbacks":{"afterExecFinish":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}},"appPackageName":"com.zdanjian.zdanjian","closeBeforeOpen":true,"onlyClose":false}}]}],"runMode":"normal"},"afterExecFail":{"type":"运行JS代码","delay":"0","delayUnit":1,"scriptCallbacks":{"afterExecSuc":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}},"jsCode":"const fs=require(\"fs\");\nconst path = require('path');\nfs.appendFileSync(\"\/sdcard\/documents\/联网更新日志.txt\",\"脚本更新模块错误，安装失败\\n\\n\");\nzdjl.toast(\"更新失败，请修复客户端或者在脚本市场更新\");"}},"jsCode":"const fs = require(\"fs\");  \nconst path = require('path');  \nconst moment = require('moment');  \nconst md5 = require('md5');\nzdjl.toast(\"与君初相识，犹如故人归。\\n正在配置更新信息，请勿断电或退出……\");\nsleep(3200);\nvar time=moment(); \nvar now=time.format('YYYY-MM-DD HH:mm:ss');\nvar str=\"更新时间：\"+now+\"\\n更新版本：\"+v+\"\\n更新大小：\"+size+\"\\n更新描述：\"+note+\"\\n更新状态：\"\nfs.appendFileSync(\"\/sdcard\/documents\/联网更新日志.txt\",str)\n\n\nzdjl.toast(\"剑阁峥嵘而崔嵬，一夫当关万夫莫开。\\n正在下载最新版本，请勿断电或退出……\");\nsleep(3200);\nvar loadUrl = \"https:\/\/bilibiliales.github.io\/example\/temp\/version\/v\"+v+\".zjs\";\nfetch(loadUrl)\n  .then(response => {\n    if (!response.ok) {\n      throw new Error('网络响应错误或请求地址错误，状态码: ' + response.status);\n    }\n    return response.text();\n  })\n  .then(text => {\n    console.log(text);\n\n    \/\/ 计算text的MD5校验和  \n    const checksum = md5('hex');\n    console.log('本地MD5校验和为:', checksum); \n    \n    zdjl.toast(\"青，取之于蓝而青于蓝；冰，水为之而寒于水。\\n正在安装更新，请勿断电或退出\");\nsleep(3200);\nvar localPath = \"\/sdcard\/自动精灵\/联网更新向导.zjs\";  \n    console.log(\"将安装新版本至\" + localPath);  \n    if (checksum === checksum1 || checksum === checksum2) {  \n      try {  \n        fs.writeFileSync(localPath, text, 'utf8');  \n        console.log(\"已成功将新版本安装在了：\", localPath);  \n        fs.appendFileSync(\"\/sdcard\/documents\/联网更新日志.txt\", \"安装成功\\n\\n\");  \n      } catch (error) {  \n        console.error(\"写入文件时出错：\", error);  \n        fs.appendFileSync(\"\/sdcard\/documents\/联网更新日志.txt\", \"安装过程中发生错误\\n\\n\");  \n      }  \n    } else {  \n      fs.appendFileSync(\"\/sdcard\/documents\/联网更新日志.txt\", \"产品签名不正确，安装失败\\n\\n\");  \n      global.stop=true;\n    }\n  })\n  .catch(error => {\n    console.error('错误:', error);\n  });\n"}
{"type":"系统提示","delay":"0","delayUnit":1,"promptType":"alert","promptText":"欢迎使用脚本，点击确定进入激活向导","promptTitle":"激活向导","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"改用联网激活"},{"name":"疑难解答","script":{"type":"系统提示","delay":"0","delayUnit":1,"promptType":"alert","promptText":"***自动联网更新脚本为联网激活脚本的一个插件，仅展示自动更新功能，联网激活脚本需另外下载***\n\n关于脚本更新：\n从12.0版本开始，脚本具有自动联网更新能力，低于12.0版本的用户仍需要通过脚本市场完成一次手动更新\n\n关于修复客户端：\n12.0版本的新能力，即不论是否需要更新，都会联网下载最新版本脚本。修复客户端之后仍然无法解决的问题请删除并重装脚本解决","promptTitle":"疑难解答向导","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"继续"},{"name":"直接下载文件","script":{"type":"打开链接","delay":"0","delayUnit":1,"scriptCallbacks":{"afterExecFinish":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}},"link":"https:\/\/bilibiliales.github.io\/example\/temp\/version"}},{"name":"修复客户端","script":{"type":"运行JS代码","delay":"0","delayUnit":1,"scriptCallbacks":{"afterExecSuc":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"jumpTo","jumpToPosition":"2","ContinueParentExecute":false}},"jsCode":"var update=true;\nglobal.update=update;"}}]}}]}
